/**
 * A simple script to read in a JSON file generated by Firefox's bookmarks
 * manager and output the bookmarks into a nicely formatted HTML file.
 */

// Dependencies:
var fs = require('fs'),
    path = require('path'),
    Q = require('q');

// Data variables:
var bookmarksJsonFile = process.argv[2],
    outputFile = process.argv[3],
    startFolder = process.argv[4],
    bookmarks = null;

// If bookmarks JSON file is a relative path, resolve it to an absolute one.
if (bookmarksJsonFile.charAt(0) != '/') {
  bookmarksJsonFile = path.resolve(__dirname, bookmarksJsonFile);
}
// Check if the bookmarks JSON file exists.
(function() {
  var deferred = Q.defer();
  fs.exists(bookmarksJsonFile, deferred.resolve);
  return deferred.promise;
})()
.then(function(exists) {
  if (!exists) {
    throw new Error('Bookmarks JSON file not found.');
  }
  // Read JSON data from file.
  return Q.nfcall(fs.readFile, bookmarksJsonFile);
})
.then(function(data) {
  bookmarks = JSON.parse(data);
  console.log('Done!');
}, function(error) {
  throw new Error('Unable to read Bookmarks JSON file. Please check its permissions.');
})
// On failure, print the error message.
.fail(function(error) {
  console.log('Error: ' + error.message);
});
